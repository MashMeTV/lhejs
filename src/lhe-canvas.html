<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="behaviors/color-utils-behavior.html">
<link rel="import" href="behaviors/lhe-encoder-behavior.html">
<link rel="import" href="behaviors/lhe-decoder-behavior.html">
<link rel="import" href="behaviors/lhe-caches-behavior.html">

<dom-module id="lhe-canvas">

  <!-- Defines the element's style and local DOM -->
  <template>
    <style>
      :host {
        display: block;
        padding: 10px;
      }
      .card {
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        padding: 16px;
        margin: 24px;
        border-radius: 5px;
        background-color: #fff;
        color: #757575;
        overflow: scroll;
      }
      h1 {
        font-size: 22px;
        margin: 16px 0;
        color: #212121;
      }
      canvas {
        border: 1px solid black;
        margin: auto;
      }
      .centered{
        text-align: center;
      }
    </style>
    <div class="card">
      <p>Loaded: {{image}} ({{width}}x{{height}}px)</p>
    </div>

    <div class="card centered">
      <canvas id="imagecanvas" width="{{width}}" height="{{height}}"></canvas>
      <canvas id="decoded" width="{{width}}" height="{{height}}"></canvas>
    </div>
  </template>

  <!-- Creates the element's prototype and registers it -->
  <script>
    Polymer({
      is: 'lhe-canvas',

      properties: {
        route: Object,
        image: {
          type: String,
          value: '../images/samples/lena.png'
        },
        width: {
          type: Number
        },
        height: {
          type: Number
        }
      },

      behaviors:[LHEJS.ColorUtilsBehavior, LHEJS.EncoderBehavior, LHEJS.DecoderBehavior, LHEJS.CachesBehavior],

      attached: function(){
        this._renderImage();
      },

      _renderImage: function(){
        var el = this;
        var canvas = this.$.imagecanvas;
        var ctx=canvas.getContext("2d");
        var img=new Image();
        img.src = this.image;
        img.onload = function(){
          el.width = img.width;
          el.height = img.height;
          ctx.drawImage(img,0,0);
          el.original_data = el.canvas2YUV(el.$.imagecanvas);

          //TEST
          el.LHEBasicEncode();
          el.LHEBasicDecode();
          el.YUV2canvas(el.decodedImage, el.$.decoded);
        }
      }
    });
  </script>

</dom-module>